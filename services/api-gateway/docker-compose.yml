version: "3.9"

networks:
    kong-net:
        driver: bridge

services:
    #######################################
    # Kong: The API Gateway (DB-less mode)
    #######################################
    kong:
        image: kong:latest
        container_name: kong
        restart: always
        networks:
            - kong-net
        volumes:
            - ./kong.yml:/usr/local/kong/declarative/kong.yml:ro
        environment:
            KONG_DATABASE: "off"
            KONG_DECLARATIVE_CONFIG: /usr/local/kong/declarative/kong.yml
            KONG_PROXY_ACCESS_LOG: /dev/stdout
            KONG_ADMIN_ACCESS_LOG: /dev/stdout
            KONG_PROXY_ERROR_LOG: /dev/stderr
            KONG_ADMIN_ERROR_LOG: /dev/stderr
            KONG_ADMIN_LISTEN: 0.0.0.0:8001
            KONG_ADMIN_GUI_LISTEN: 0.0.0.0:8002
            KONG_ADMIN_GUI_URL: http://localhost:8002
        ports:
            - "8000:8000" # Kong proxy port
            - "8001:8001" # Kong Admin API
            - "8002:8002" # Kong Manager OSS (Official UI)
        healthcheck:
            test: ["CMD", "kong", "health"]
            interval: 10s
            timeout: 10s
            retries: 10
