_format_version: "3.0"

services:
    - name: user-company-service
      url: http://host.docker.internal:8003

    - name: post-hire-service
      url: http://host.docker.internal:8004

    - name: chat-notification-service
      url: http://host.docker.internal:8005

routes:
    # User-company service routes
    - name: route-for-user-company
      service: user-company-service
      paths:
          - /api/v1/auth
          - /api/v1/me
          - /api/v1/users
          - /api/v1/companies
          - /api/v1/industries
          - /api/v1/skills
          - /api/v1/schools
          - /api/v1/locations
          - /api/v1/recommend
          - /api/v1/internals
      strip_path: false

    # Post-hire service routes
    - name: route-for-post-hire
      service: post-hire-service
      paths:
          - /storage
          - /api/v1/posts
          - /api/v1/jobs
          - /api/v1/feed
          - /api/v1/search
      strip_path: false

    # Chat service routes - Đặt TRƯỚC để ưu tiên (more specific paths first)
    - name: route-for-chat-notification
      service: chat-notification-service
      paths:
          - /api/v1/conversations
          - /api/v1/messages
          - /api/v1/users
      strip_path:
          false

          #   TODO: JWT, CORS, RATE LIMIT
# consumers:
#     - username: social-network-user
#       jwt_secrets:
#           - key: my-app-key
#             secret: change-this-to-a-very-strong-secret-key-in-production

plugins:
    - name: cors
      config:
          origins:
              - "http://localhost:3000"
              - "https://your-production-domain.com"
          methods:
              - GET
              - POST
              - PUT
              - PATCH
              - DELETE
              - OPTIONS
          headers:
              - "Authorization"
              - "Content-Type"
              - "X-User-Id"
              - "X-User-Type"
          exposed_headers:
              - "X-Custom-Header"
          credentials: true
          max_age: 3600

    - name: rate-limiting
      config:
          minute: 100 # Max requests per minute
          hour: 2000 # Max requests per hour
          policy: local # Can be 'local', 'cluster', or 'redis'
          limit_by: consumer # Limit per authenticated consumer
          hide_client_headers: true
